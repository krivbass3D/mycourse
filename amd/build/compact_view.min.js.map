{"version":3,"file":"compact_view.min.js","sources":["../src/compact_view.js"],"sourcesContent":["//import log from 'core/log';\nimport ajax from 'core/ajax';\nimport templates from 'core/templates';\nimport config from 'core/config';\nimport notification from 'core/notification';\nimport $ from 'jquery';\nimport * as slider from 'block_mycourse/course_slider';\n\nexport const init = (id) => {\n\n          $('section').on(\"click\",'#inst'+id+' .target_normal', function () {\n                  show_compact_view($(this),id,false);\n                  return false;\n          });\n\n          $('section').on(\"click\",'#inst'+id+' .target_compact', function () {\n                  show_compact_view($(this),id,true);\n                  return false;\n          });\n};\n\nconst show_compact_view = (element,id,compact) =>  {\n                var current_view = 0;\n                var switch_view = element.closest('.msmycourses_wrapper').find('.switch_view');\n                var category = element.closest('.category');\n\n                if(switch_view.data('currentview') == 1) {\n                    current_view = 1;\n                }\n                        var promises = ajax.call([\n                                {\n                                        methodname: 'block_mycourse_load_category',\n                                        args: {\n                                                blockid: id,\n                                                use_compact_view: compact,\n                                                current_view: current_view,\n                                                category_id: category.data('id'),\n                                                level: category.data('level'),\n                                                load_savestate: true,\n                                                load_compact_savestate: false\n                                        }\n                                }\n                        ]);\n\n                        promises[0].done(function(response) {\n                                    category.children('.children').remove();\n                                    var children = document.createElement(\"div\");\n                                    children.classList.add('children');\n                                    category.append(children);\n                                    if(response.slider) {\n                                          templates.render('block_mycourse/course_slider', response).then(function (html, js) {\n                                                      templates.appendNodeContents(category.children('.children'), html, js);\n                                                      slider.init(category,response.slider_config);\n                                          });\n                                    }\n                                    else {\n                                          $.each(response.records, function(key, record){\n                                                  record.config = config;\n                                                  record.show_favorites = response.show_favorites;\n                                                  record.remove_activities = response.remove_activities;\n                                                  record.is_compact_view = response.is_compact_view;\n                                                  templates.render('block_mycourse/item', record).then(function (html, js) {\n                                                      templates.appendNodeContents(category.children('.children'), html, js);\n                                                  }).fail(notification.exception);\n                                          });\n                                    }\n\n                                    templates.render('block_mycourse/compact_selector', response)\n                                            .then(function (html, js) {\n                                                templates.replaceNode(category.find('.compact_selector_wrapper'), html, js);\n                                            }).fail(notification.exception);\n                      });\n\n                      var savestate = ajax.call([\n                                      {\n                                            methodname: 'block_mycourse_savestates_compact',\n                                            args: {\n                                                      blockid: id,\n                                                      category: category.data('id'),\n                                                      current_view: current_view,\n                                                      compact: compact\n                                            }\n                                      }\n                        ]);\n                        savestate[0].done(function() {\n                        }).fail(notification.exception);\n};"],"names":["id","on","show_compact_view","this","element","compact","current_view","switch_view","closest","find","category","data","ajax","call","methodname","args","blockid","use_compact_view","category_id","level","load_savestate","load_compact_savestate","done","response","children","remove","document","createElement","classList","add","append","slider","render","then","html","js","appendNodeContents","init","slider_config","each","records","key","record","config","show_favorites","remove_activities","is_compact_view","fail","notification","exception","replaceNode"],"mappings":"yyDAQoB,SAACA,wBAET,WAAWC,GAAG,QAAQ,QAAQD,GAAG,mBAAmB,kBAC9CE,mBAAkB,mBAAEC,MAAMH,IAAG,IACtB,yBAGb,WAAWC,GAAG,QAAQ,QAAQD,GAAG,oBAAoB,kBAC/CE,mBAAkB,mBAAEC,MAAMH,IAAG,IACtB,UAInBE,kBAAoB,SAACE,QAAQJ,GAAGK,aAClBC,aAAe,EACfC,YAAcH,QAAQI,QAAQ,wBAAwBC,KAAK,gBAC3DC,SAAWN,QAAQI,QAAQ,aAEO,GAAnCD,YAAYI,KAAK,iBAChBL,aAAe,GAEIM,cAAKC,KAAK,CACjB,CACQC,WAAY,mCACZC,KAAM,CACEC,QAAShB,GACTiB,iBAAkBZ,QAClBC,aAAcA,aACdY,YAAaR,SAASC,KAAK,MAC3BQ,MAAOT,SAASC,KAAK,SACrBS,gBAAgB,EAChBC,wBAAwB,MAKvC,GAAGC,MAAK,SAASC,UACdb,SAASc,SAAS,aAAaC,aAC3BD,SAAWE,SAASC,cAAc,OACtCH,SAASI,UAAUC,IAAI,YACvBnB,SAASoB,OAAON,UACbD,SAASQ,0BACIC,OAAO,mCAAoCT,UAAUU,MAAK,SAAUC,KAAMC,uBAC9DC,mBAAmB1B,SAASc,SAAS,aAAcU,KAAMC,IACnEJ,OAAOM,KAAK3B,SAASa,SAASe,kCAIxCC,KAAKhB,SAASiB,SAAS,SAASC,IAAKC,QAC/BA,OAAOC,OAASA,gBAChBD,OAAOE,eAAiBrB,SAASqB,eACjCF,OAAOG,kBAAoBtB,SAASsB,kBACpCH,OAAOI,gBAAkBvB,SAASuB,mCACxBd,OAAO,0BAA2BU,QAAQT,MAAK,SAAUC,KAAMC,uBAC3DC,mBAAmB1B,SAASc,SAAS,aAAcU,KAAMC,OACpEY,KAAKC,sBAAaC,iCAIzBjB,OAAO,sCAAuCT,UAC/CU,MAAK,SAAUC,KAAMC,uBACRe,YAAYxC,SAASD,KAAK,6BAA8ByB,KAAMC,OACzEY,KAAKC,sBAAaC,cAG3BrC,cAAKC,KAAK,CACV,CACMC,WAAY,wCACZC,KAAM,CACIC,QAAShB,GACTU,SAAUA,SAASC,KAAK,MACxBL,aAAcA,aACdD,QAASA,YAI7B,GAAGiB,MAAK,eACfyB,KAAKC,sBAAaC"}